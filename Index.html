<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8" />
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
  <title>养老综合平台</title>
  <!-- <script src="Build/Cesium/Cesium.js"></script> -->
  <script src="js/jquery-3.5.1.min.js"></script>

  <style>
    body,
    html {
      margin: 0;
      padding: 0;
    }

    a:hover {
      color: red;
    }

    .mapEarth {
      position: absolute;
      width: 80%;
      height: 100%;
      display: inline-block;
      float: right;
      display: inline-block;
    }

    .menu {
      float: left;
      width: 20%;
      height: 100%;
    }

    .menu div {
      list-style: none;
      height: 40px;
      background-color: #F7F7F7;
      text-align: center;
      border: 0.2px solid #DFDFDF;

    }

    .fontWeight {
      font-weight: 800;
      color: black;
    }

    a {
      font-size: 14px;
      font-family: Arial, "宋体";
      line-height: 40px;
      text-decoration: none;
      color: #0a001f;
    }
  </style>
</head>


<body>

  <a href="minzheng/helloworld.html">民政局入口</a><br />
  <a href="laorenzinv/helloworld.html">老人子女入口</a><br />
  <a href="shequ/helloworld.html">社区入口</a><br />
  <a href="yanglaoyuan/helloworld.html">养老院入口</a><br />

  <script>

    //       console.log(sguangchang);
    //       console.log(sgongyuan);
    //       console.log(sqicai);




    //     //$('#sales').append('<tr><td>' + theTerritory + '</td><td>' + numEmployees + '</td><td>$' + theAmount + '</td></tr>');
    //   });
    // }

    var indexedDB = window.indexedDB;
    var db;
    if (!indexedDB) {
      window.alert("你的浏览器不支持IndexedDB");
    }
    var request = indexedDB.open("yanglao");

    request.onerror = function (event) {
      console.log('数据库打开报错');
    };

    request.onsuccess = function (event) {
      db = event.target.result;
      console.log('数据库打开成功');
      //公安户口数据导入
      addhukou();
      //社区数据导入
      addshequ();
      addshequlaoren();
      //养老院数据导入
      addyanglaoyuan();
      addminzhengyanglaoyuan();
      addyanglaoyuanlaoren();
    }
    request.onupgradeneeded = function (e) {
      db = event.target.result;
      console.log("版本变化");
      if (!db.objectStoreNames.contains('hukou')) {
        objectStore = db.createObjectStore('hukou', { keyPath: 'id' });
      };
      if (!db.objectStoreNames.contains('shequ')) {
        objectStore = db.createObjectStore('shequ', { keyPath: 'sid' });
      };
      if (!db.objectStoreNames.contains('shequlaoren')) {
        objectStore = db.createObjectStore('shequlaoren', { keyPath: 'id' });
      };
      if (!db.objectStoreNames.contains('yanglaoyuan')) {
        objectStore = db.createObjectStore('yanglaoyuan', { keyPath: 'yid' });
      };
      if (!db.objectStoreNames.contains('minzhengyanglaoyuan')) {
        objectStore = db.createObjectStore('minzhengyanglaoyuan', { keyPath: 'yid' });
      };
      if (!db.objectStoreNames.contains('yanglaoyuanlaoren')) {
        objectStore = db.createObjectStore('yanglaoyuanlaoren', { keyPath: 'id' });
      };

      //add();
    }
    function addhukou() {
      $(document).ready(function () {
        $.get('source/hukou.txt', function (theData) {
          console.log(theData);
          theItems = theData.split('\n');
          //test = theItems[1].split(' ');
          var theList = '';
          var theListItem;
          //从第二行开始读入数据
          for (i = 1; i < theItems.length; i++) {
            temp = theItems[i].split(' ');
            // var name = temp[0];
            // var id = temp[1]; 
            // var birthday = 

            var request = db.transaction(['hukou'], 'readwrite')
              .objectStore('hukou')
              .add({ name: temp[0], id: temp[1], gender: temp[2], birthday: temp[3], marriage: temp[4], polistatus: temp[5], birthplace: temp[6], address: temp[7] });

          };
          // $('#fileData').html(theList);
        });
      });
    }

    //storename,sid,sname,saddress,smanager,scontactnum,sworkernum,sguangchang,sgongyuan,sqicai
    function addshequ() {
      $(function () {
        //通过使用ajax()，可以获得xml文件并将数据发送到一个自定义的解析函数中
        $.ajax({
          type: "GET",
          url: "source/SheQu.xml",
          dataType: "xml",
          success: xmlParser1
        });
      });
      //自定义解析xmlParser函数
      function xmlParser1(xml) {
        console.log(xml);
        //jquery的find函数定位xml中的节点
        //each循环中，将xml的值赋给遍历，并使用这些遍历构建标记
        $(xml).find('shequ').each(function () {
          var sid = $(this).find('sid').text()
          var sname = $(this).find('sname').text()
          var saddress = $(this).find('saddress').text()
          var smanager = $(this).find('smanager').text()
          var scontactnum = $(this).find('scontactnum').text()
          var sworkernum = $(this).find('sworkernum').text()
          var sguangchang = $(this).find('sguangchang').text()
          var sgongyuan = $(this).find('sgongyuan').text()
          var sqicai = $(this).find('sqicai').text()

          var request = db.transaction(['shequ'], 'readwrite')
            .objectStore('shequ')
            .add({
              sid: sid, sname: sname, saddress: saddress, smanager: smanager,
              scontactnum: scontactnum, sworkernum: sworkernum, sguangchang: sguangchang, sgongyuan: sgongyuan, sqicai: sqicai
            });
        })
      }
    }

    function addshequlaoren() {
      $(function () {
        //通过使用ajax()，可以获得xml文件并将数据发送到一个自定义的解析函数中
        $.ajax({
          type: "GET",
          url: "source/SheQu-laoren.xml",
          dataType: "xml",
          success: xmlParser
        });
      });
      //自定义解析xmlParser函数
      function xmlParser(xml) {
        console.log(xml);
        //jquery的find函数定位xml中的节点
        //each循环中，将xml的值赋给遍历，并使用这些遍历构建标记
        $(xml).find('slaoren').each(function () {
          var sid = $(this).find('sid').text()
          var id = $(this).find('id').text()
          var children = $(this).find('children').text()
          var spouse = $(this).find('spouse').text()
          var others = $(this).find('others').text()

          var request = db.transaction(['shequlaoren'], 'readwrite')
            .objectStore('shequlaoren')
            .add({ sid: sid, id: id, children: children, spouse: spouse, others: others });
        })
      }
    }

    //养老院
    function addyanglaoyuan() {

      $.getJSON("source/yang.json", function (data) {
        $.each(data, function (i, item) {
          var yid = item.yid;
          var yname = item.yname;
          var address = item.address;
          var fuzeren = item.fuzeren;
          var phone = item.phone;
          var cost = item.cost;
          var bednum = item.bednum;
          var personnum = item.personnum;
          var area = item.area;

          var request = db.transaction(['yanglaoyuan'], 'readwrite')
            .objectStore("yanglaoyuan")
            .add({ yid: yid, yname: yname, address: address, fuzeren: fuzeren, phone: phone, cost: cost, bednum: bednum, personnum: personnum, area: area });

        });

      });
    }

    //民政局-养老院
    function addminzhengyanglaoyuan() {

      $.getJSON("source/minyang.json", function (data) {
        $.each(data, function (i, item) {
          var yid = item.yid;
          var yname = item.yname;
          var address = item.address;
          var fuzeren = item.fuzeren;
          var lon = item.lon;
          var lat = item.lat;
          var pingjia = item.pingjia;

          var request = db.transaction(['minzhengyanglaoyuan'], 'readwrite')
            .objectStore("minzhengyanglaoyuan")
            .add({ yid: yid, yname: yname, address: address, fuzeren: fuzeren, lon: lon, lat: lat, pingjia: pingjia });


        });

      });
    }

    //养老院-老人
    function addyanglaoyuanlaoren() {

      $.getJSON("source/yangren.json", function (data) {
        $.each(data, function (i, item) {
          var id = item.id;
          var name = item.name;
          var yid = item.yid;
          var yname = item.yname;
          var gender = item.gender;
          var birthday = item.birthday;
          var bedid = item.bedid;

          var request = db.transaction(['yanglaoyuanlaoren'], 'readwrite')
            .objectStore("yanglaoyuanlaoren")
            .add({ id: id, name: name, yid: yid, yname: yname, gender: gender, birthday: birthday, bedid: bedid });

        });

      });
    }

        // var request = db.transaction(['shequ'], 'readwrite')
        //   .objectStore('shequ')
        //   .add({ sid: sid, sname: '西关社区', saddress: "湖北省武汉市硚口区沿河大道418号" });

        // request.onsuccess = function (event) {
        //   console.log('数据写入成功');
        // };

        // request.onerror = function (event) {
        //   console.log('数据写入失败');
        // }

    //add();
  </script>

</body>

</html>

</body>

</html>