<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8" />
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
  <title>老人子女入口</title>
  <script src="../js/jquery-3.5.1.min.js"></script>


</head>


<body>

  <style>
    .ripple {
				position: relative;
				/*//隐藏溢出的径向渐变背景*/
				overflow: hidden;
			}
			
			.ripple:after {
				content: "";
				display: block;
				position: absolute;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				pointer-events: none;
				/*//设置径向渐变*/
				background-image: radial-gradient(circle, #666 10%, transparent 10.01%);
				background-repeat: no-repeat;
				background-position: 50%;
				transform: scale(10, 10);
				opacity: 0;
				transition: transform .3s, opacity .5s;
			}
			
			.ripple:active:after {
				transform: scale(0, 0);
				opacity: .3;
				/*//设置初始状态*/
				transition: 0s;
			}
			.btn-sign{
				border-width:0px;
		
				 width: 200px;
				 height: 200px;
			}
     



  </style>


  <h1 style="text-align: center">告诉我们您的需要</h1>
  

  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td align="center"><input type ="button" id="lifa" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/cuthair.png) no-repeat 0 0;" name = "理发" onclick="qingqiu()"></input> </td>
      <td align="center"><input type ="button" id="songcan" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/food.png) no-repeat 0 0;" name = "送餐" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="jiuyi" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/doctor.png) no-repeat 0 0;" name = "就医" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="huli" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/nurse.png) no-repeat 0 0;" name = "护理" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="jiazheng" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/clean.png) no-repeat 0 0;" name = "家政" onclick="qingqiu()"></input></input></td>
      <td align="center"><input type ="button" id="zuoche" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/car.png) no-repeat 0 0;" name = "坐车" onclick="qingqiu()"></input></td>


    </tr>
    <tr>
      <td align="center">理发</td>
      <td align="center">送餐</td>
      <td align="center">就医</td>
      <td align="center">护理</td>
      <td align="center">家政</td>
      <td align="center">坐车</td>
    </tr>
  </table>
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr>
      <td align="center"><input type ="button" id="weixiu" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/xiu.png) no-repeat 0 0;" name = "维修" onclick="qingqiu()"></input> </td>
      <td align="center"><input type ="button" id="peiban" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/peiban.png) no-repeat 0 0;" name = "陪伴" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="tijian" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/tijian.png) no-repeat 0 0;" name = "体检" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="songyao" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/yao.png) no-repeat 0 0;" name = "送药" onclick="qingqiu()"></input></td>
      <td align="center"><input type ="button" id="yule" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/dance.png) no-repeat 0 0;" name = "娱乐" onclick="qingqiu()"></input></input></td>
      <td align="center"><input type ="button" id="zixun" class="btn-sign btn btn-default ripple btn-lg" style="background:url(img/zixun.png) no-repeat 0 0;" name = "咨询" onclick="qingqiu()"></input></td>


    </tr>
    <tr>
      <td align="center">维修</td>
      <td align="center">陪伴</td>
      <td align="center">体检</td>
      <td align="center">送药</td>
      <td align="center">娱乐</td>
      <td align="center">咨询</td>
    </tr>
  </table>

  <script>
    var mname;
    var now = new Date();
    var year = now.getFullYear();
    var month = now.getMonth()+1;
    var day = now.getDay();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    var date = year+"年"+month+"月"+day+"日"+hour+"时"+minute+"分"+second+"秒";

    var id = parseInt(sessionStorage.getItem("id"));
    
    //$("input").click(function (e) {
    $("input").off("click").on("click", function (e) {
      mid = $(e.target).attr("id");
      mname = document.getElementById(mid).name;
    });

    
    var db;
    var indexedDB = window.indexedDB;
    //var db;
    if (!indexedDB) {
      window.alert("你的浏览器不支持IndexedDB");
    }
    //打开数据库
    var request = window.indexedDB.open("yanglao", 1);
    request.onerror = function (event) {
      console.log('数据库打开报错');
    };
    request.onupgradeneeded = function (event) {
      db = event.target.result;
      console.log("版本变化");

    }

    request.onsuccess = function (event) {
      db = event.target.result;

    }



    //向服务器发送请求
    //qingqiu  = function(){
    function qingqiu() {





      //判断老人在社区还是养老院
      var name = "";

      var res1 = db.transaction(['hukou'], 'readonly').objectStore('hukou').get(id);
      res1.onerror = function (event) {
        console.log('事务失败');
      };

      res1.onsuccess = function (event) {
        console.log("拿到老人数据");
        name = res1.result.name;
        //判断老人在社区还是养老院
        var res2 = db.transaction(['shequlaoren'], 'readonly').objectStore('shequlaoren')
              .get(id);
            res2.onerror = function (event) {
              console.log('读入失败');
            };
            res2.onsuccess = function (event) {
              if(event.target.result){
                //社区
                console.log("进入社区循环");
                //获取老人对应社区的sid
                var sid = res2.result.sid;
                var res3 = db.transaction(['shequqingqiu'], 'readwrite').objectStore('shequqingqiu').add({ sid: sid, id: id, name: name, leixing: mname,date:date, isok: 0 });
                res3.onerror = function (event) {
                  console.log('写入失败');
                };
                res3.onsuccess = function (event) {
                  console.log('写入成功');
                }
                alert("您当前居住于社区中，我们已联系社区志愿者尽快为您提供" + mname+"服务");

              }else{
                var res4 = db.transaction(['yanglaoyuanlaoren'], 'readonly').objectStore('yanglaoyuanlaoren')
                      .get(id);
                     res4.onerror = function (event) {
                      console.log('读入失败');
                     };
                     res4.onsuccess = function (event) {
                       if(event.target.result){
                           //养老院 
                          console.log("进入养老院循环");
                          var yid = res4.result.yid;
                          var res5 = db.transaction(['yanglaoyuanqingqiu'], 'readwrite').objectStore('yanglaoyuanqingqiu').add({ yid: yid, id: id, name: name, leixing: mname, date:date,isok: 0 });
                          res5.onerror = function (event) {
                            console.log('写入失败');
                          };
                          res5.onsuccess = function (event) {
                            console.log('写入成功');

                          };
                          alert("您当前居住于养老院中，我们已联系社区志愿者尽快为您提供" + mname+"服务");


                       }else{
                         //都不在
                         alert("抱歉您无法使用服务，建议您加入社区或养老院！");
                       }

                   
                     }

              }
            }
          }

         
      console.log('数据库打开成功');
    }






  </script>


</body>

</html>