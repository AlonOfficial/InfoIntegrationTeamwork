<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8" />
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
  <title>养老综合平台</title>
  <!-- <script src="Build/Cesium/Cesium.js"></script> -->
  <script src="js/jquery-3.5.1.min.js"></script>

</head>


<body>

  <button type="button">民政局入口</button>
  <button type="button">老人/子女入口</button>
  <button type="button">养老机构入口</button>
  <button type="button">社区入口</button>

  <script>

    //       console.log(sguangchang);
    //       console.log(sgongyuan);
    //       console.log(sqicai);




    //     //$('#sales').append('<tr><td>' + theTerritory + '</td><td>' + numEmployees + '</td><td>$' + theAmount + '</td></tr>');
    //   });
    // }

    var indexedDB = window.indexedDB;
    var db;
    if (!indexedDB) {
      window.alert("你的浏览器不支持IndexedDB");
    }
    var request = indexedDB.open("yanglao");

    request.onerror = function (event) {
      console.log('数据库打开报错');
    };

    request.onsuccess = function (event) {
      db = event.target.result;
      console.log('数据库打开成功');

      addshequ();
      addshequlaoren();
    }
    request.onupgradeneeded = function (e) {
      db = event.target.result;
      console.log("版本变化");
      if (!db.objectStoreNames.contains('shequ')) {
        objectStore = db.createObjectStore('shequ', { keyPath: 'sid' });
      };
      if (!db.objectStoreNames.contains('shequlaoren')) {
        objectStore = db.createObjectStore('shequlaoren', { keyPath: 'id' });
      };
      //add();
    }


    //storename,sid,sname,saddress,smanager,scontactnum,sworkernum,sguangchang,sgongyuan,sqicai
    function addshequ() {
      $(function () {
        //通过使用ajax()，可以获得xml文件并将数据发送到一个自定义的解析函数中
        $.ajax({
          type: "GET",
          url: "source/SheQu.xml",
          dataType: "xml",
          success: xmlParser1
        });
      });
      //自定义解析xmlParser函数
      function xmlParser1(xml) {
        console.log(xml);
        //jquery的find函数定位xml中的节点
        //each循环中，将xml的值赋给遍历，并使用这些遍历构建标记
        $(xml).find('shequ').each(function () {
          var sid = $(this).find('sid').text()
          var sname = $(this).find('sname').text()
          var saddress = $(this).find('saddress').text()
          var smanager = $(this).find('smanager').text()
          var scontactnum = $(this).find('scontactnum').text()
          var sworkernum = $(this).find('sworkernum').text()
          var sguangchang = $(this).find('sguangchang').text()
          var sgongyuan = $(this).find('sgongyuan').text()
          var sqicai = $(this).find('sqicai').text()

          var request = db.transaction(['shequ'], 'readwrite')
            .objectStore('shequ')
            .add({sid: sid, sname: sname, saddress: saddress, smanager: smanager,
              scontactnum: scontactnum, sworkernum: sworkernum, sguangchang: sguangchang, sgongyuan: sgongyuan, sqicai: sqicai});
        })
      }
    }

    function addshequlaoren() {
      $(function () {
        //通过使用ajax()，可以获得xml文件并将数据发送到一个自定义的解析函数中
        $.ajax({
          type: "GET",
          url: "source/SheQu-laoren.xml",
          dataType: "xml",
          success: xmlParser
        });
      });
      //自定义解析xmlParser函数
      function xmlParser(xml) {
        console.log(xml);
        //jquery的find函数定位xml中的节点
        //each循环中，将xml的值赋给遍历，并使用这些遍历构建标记
        $(xml).find('slaoren').each(function () {
          var sid = $(this).find('sid').text()
          var id = $(this).find('id').text()
          var children = $(this).find('children').text()
          var spouse = $(this).find('spouse').text()
          var others = $(this).find('others').text()

          var request = db.transaction(['shequlaoren'], 'readwrite')
            .objectStore('shequlaoren')
            .add({ sid: sid, id: id, children: children, spouse: spouse, others: others });
        })
      }
    }

    // var request = db.transaction(['shequ'], 'readwrite')
    //   .objectStore('shequ')
    //   .add({ sid: sid, sname: '西关社区', saddress: "湖北省武汉市硚口区沿河大道418号" });

    // request.onsuccess = function (event) {
    //   console.log('数据写入成功');
    // };

    // request.onerror = function (event) {
    //   console.log('数据写入失败');
    // }

//add();
  </script>

</body>

</html>