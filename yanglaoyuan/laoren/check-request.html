
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>查看请求</title>
    <script src = '../../js/jquery-3.5.1.min.js'></script>
    <script src = '../../js/jquery-3.5.1.min.js'></script>
    <style>
        .d{
            color: red;
        }
    </style>
</head>
<body>
<h>test</h>
<div class="show-request" id="request-result">
    <table id="older-request" class="request-table"></table>
</div>
<script>
    //获取登录老人id，这个需要实现登录功能将id传过来
    var NursingId = 1;
    var olderNursinglist = new Array();
    //向服务器发送请求
    var indexedDB = window.indexedDB;
    var db;
    if (!indexedDB) {
        window.alert("你的浏览器不支持IndexedDB");
    }


    //打开数据库
    var request = window.indexedDB.open("yanglao", 1);
    request.onerror = function (event) {
        console.log('数据库打开报错');
    };
    request.onupgradeneeded = function (e) {
        db = event.target.result;
        console.log("版本变化");

    }
    request.onsuccess = function (event) {
        db = event.target.result;
    }

    function showData() {
        var store = db.transaction(['yanglaoyuanlaoren'], 'readonly').objectStore('yanglaoyuanlaoren');
        var c = store.openCursor();//打开游标
        c.onsuccess = function (e) {//成功执行回调
            var cursor = e.target.result;
            if (cursor) {//如果存在
                var older = cursor.value;
                if (older.yid == NursingId) {
                    olderNursinglist.push(older);
                    var id = older.id;
                    var name = older.name;
                    var gender = older.gender;
                    var birthday = older.birthday;
                    var bedid = older.bedid;
                    var html = "";
                    html += '<tr>';
                    html += '<th> Id</th>' + '<td>' + id + '</td>';
                    html += '<th> Name</th>' + '<td>' + name + '</td>';
                    html += '<th> gender</th>' + '<td>' + gender + '</td>';
                    html += '<th> birthday</th>' + '<td>' + birthday + '</td>';
                    html += '<th> bedid</th>' + '<td>' + bedid + '</td>';
                    html += '<td><input type="button" id="delete" value="删除"> </input></td>'
                    html += '<td><input type="button" id="confirm" value="确认"> </input></td>'
                    html += '</tr>';
                    $("#older-request").append(html);
                }
                cursor.continue();//继续下一个
            }


        }
    }

    setTimeout(() => {
        showData();
    }, 500);

</script>

<script>

    $(document).on('click', '#delete', function () {
        $(this).addClass('d');
        // alert("已删除");

        // var trs = $(this).parent().find('td'); //获取所有tr
        // if(trs.hasClass('d')){ //判断这些tr 有没有Class ‘on’’
        //     trs.removeClass('d');//把class on 移除
        // }
        // $(this).addClass('d');//点击的tr 添加 on class 用于改变样式
        // // Wenshiduinfo= $(this).text()
        //
        // var text =[];
        //
        $(this).parent().parent().children('td').each(function(j){  // 遍历 tr 的各个 td
            // text.push($(this).html());
            alert($(this).html());
        });
    });
    $(document).on('click', '#confirm', function () {
        $(this).addClass('d');
        var text =[];
        $(this).parent().parent().children('td').each(function(j){  // 遍历 tr 的各个 td
            text.push($(this).html());
        });

        var id = text[0];
        var name =text[1];
        var gender = text[2];
        var birthday =text[3];
    });


</script>
</body>
</html>