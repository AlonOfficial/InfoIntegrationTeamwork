<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8"/>
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title>养老院入口</title>
    <script src="../../js/jquery-3.5.1.min.js"></script>
    <style>
        .check-apply{
            display: none;
        }
        .show{
            display: block;
        }
        .table{

        }
    </style>
</head>
<body>
<div class="infor" >
    <button id ='check-in'>申请入住</button>
    <div class="check-apply" id="register">
        <table>
        <tr><td>姓名</td><td><input class="item" id="vname"></input></td></tr>
        <tr><td>身份证</td><td><input class="item" id="vid"></input></td></tr>
        <tr><td>性别</td><td><input class="item" id="vgender"></input></td></tr>
        <tr><td>生日</td><td><input class="item" id="vbirthday"></input></td></tr>
        <tr><td>床位</td><td><input class="item" id="vbedid"></input></td></tr>
        </table>
        <button id="register-commit">提交</button>
    </div>
</div>
<script>

    //登录请求获得
    var yid = 2


    $("#check-in").click(function()
    {
        var obj = $("#register");
        if(obj.hasClass('check-apply')){
            obj.removeClass('check-apply').addClass('show');
        }else {
            obj.removeClass('show').addClass('check-apply');
        }
    })
    $("#register-commit").click(function () {
        var id = $("#vid").val();
        var name = $("#vname").val();
        var yid = yid;
        var yname = '红星养老院';
        var gender = $("#vgender").val();
        var birthday = $("#vbirthday").val();
        var bedid = $("#vbedid").val();

        if(isNumber(id)==false){alert("请输入正确的身份证号");}
        else {
            var indexedDB = window.indexedDB;
            var db;
            if (!indexedDB) {
                window.alert("你的浏览器不支持IndexedDB");
            }

            //打开数据库
            var request = window.indexedDB.open("yanglao", 1);
            request.onerror = function (event) {
                console.log('数据库打开报错');
            };
            request.onupgradeneeded = function (e) {
                db = event.target.result;
                console.log("版本变化");

            }
            request.onsuccess = function (event) {
                db = event.target.result;
                var request = db.transaction(['yanglaoyuanlaoren'], 'readwrite')
                    .objectStore("yanglaoyuanlaoren")
                    .add({
                        id: id,
                        name: name,
                        yid: yid,
                        yname: yname,
                        gender: gender,
                        birthday: birthday,
                        bedid: bedid
                    });
                request.onsuccess = function (e) {
                    alert("入住登记成功");
                }
                request.error = function (e) {
                    alert('提交失败！')

                }
            }
        }
    })

    function isNumber(val) {
        var regPos = /^\d+(\.\d+)?$/; //非负浮点数
        var regNeg = /^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/; //负浮点数
        if(regPos.test(val) || regNeg.test(val)) {
            return true;
        } else {
            return false;
        }
    }

</script>
</body>
</html>